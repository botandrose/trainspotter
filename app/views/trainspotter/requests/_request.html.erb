<details class="request-group <%= request.status_class %>" <%= "open" unless request.completed? %>>
  <summary class="request-summary">
    <span class="request-method method-<%= request.method.downcase %>"><%= request.method %></span>
    <span class="request-path"><%= request.path %></span>
    <% if request.controller %>
      <span class="request-controller"><%= request.controller %>#<%= request.action %></span>
    <% end %>
    <span class="request-meta">
      <% if request.status %>
        <span class="request-status status-<%= request.status_class %>"><%= request.status %></span>
      <% end %>
      <% if request.duration_ms %>
        <span class="request-duration"><%= "%.1f" % request.duration_ms %>ms</span>
      <% end %>
      <% if request.sql_count > 0 %>
        <span class="request-sql" title="<%= request.sql_count %> queries, <%= "%.1f" % request.sql_duration_ms %>ms">
          ğŸ—ƒï¸ <%= request.sql_count %>
        </span>
      <% end %>
      <% if request.render_count > 0 %>
        <span class="request-renders" title="<%= request.render_count %> templates, <%= "%.1f" % request.render_duration_ms %>ms">
          ğŸ“„ <%= request.render_count %>
        </span>
      <% end %>
    </span>
    <% if request.started_at %>
      <time class="request-time" datetime="<%= request.started_at.iso8601 %>">
        <%= request.started_at.strftime("%H:%M:%S") %>
      </time>
    <% end %>
  </summary>

  <div class="request-details">
    <% request.entries.each do |entry| %>
      <div class="log-entry entry-<%= entry.type %>">
        <% case entry.type %>
        <% when :sql %>
          <span class="entry-badge sql">SQL</span>
          <span class="entry-duration"><%= "%.2f" % entry.duration_ms %>ms</span>
          <code class="entry-content"><%= ansi_to_html(entry.metadata[:query]) %></code>
        <% when :render %>
          <span class="entry-badge render">VIEW</span>
          <span class="entry-duration"><%= "%.2f" % entry.duration_ms %>ms</span>
          <span class="entry-content"><%= ansi_to_html(entry.metadata[:template]) %></span>
        <% else %>
          <pre class="entry-raw"><%= ansi_to_html(entry.raw) %></pre>
        <% end %>
      </div>
    <% end %>
  </div>
</details>
