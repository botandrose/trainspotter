<div class="trainspotter"
     data-controller="requests"
     data-requests-poll-url-value="<%= poll_requests_path %>"
     data-requests-root-url-value="<%= root_path %>"
     data-requests-since-id-value="<%= @requests.first&.id %>"
     data-requests-log-file-value="<%= @current_log_file %>"
     data-requests-ip-value="<%= @current_ip %>">
  <header class="trainspotter-header">
    <h1>Trainspotter</h1>
    <div class="trainspotter-controls">
      <% if @available_log_files.size > 1 %>
        <select name="log_file" class="log-file-selector" data-requests-target="logFile" data-action="change->requests#changeLogFile">
          <% @available_log_files.each do |log_file| %>
            <option value="<%= log_file %>" <%= "selected" if log_file == @current_log_file %>><%= log_file %></option>
          <% end %>
        </select>
      <% else %>
        <span class="current-log-file"><%= @current_log_file %></span>
      <% end %>
      <select name="ip" class="ip-filter-selector" data-requests-target="ipFilter" data-action="change->requests#changeIp">
        <option value="">All IPs</option>
        <% @available_ips.each do |ip| %>
          <option value="<%= ip %>" <%= "selected" if ip == @current_ip %>><%= ip %></option>
        <% end %>
      </select>
      <label class="auto-scroll-toggle">
        <input type="checkbox" checked data-requests-target="autoScroll">
        Auto-scroll
      </label>
      <span class="connection-status" data-requests-target="status">‚óè</span>
      <%= link_to "Sessions", sessions_path, class: "nav-link" %>
    </div>
  </header>

  <main class="trainspotter-main">
    <div class="request-list" data-requests-target="list">
      <% @requests.each do |request| %>
        <%= render "trainspotter/requests/request", request: request %>
      <% end %>
    </div>

    <% if @requests.empty? %>
      <div class="empty-state">
        <p>No requests found in the log file.</p>
        <p class="hint">Make some requests to your Rails app to see them here.</p>
      </div>
    <% end %>
  </main>
</div>
