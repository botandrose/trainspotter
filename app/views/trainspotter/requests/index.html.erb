<div class="trainspotter">
  <header class="trainspotter-header">
    <h1>Trainspotter</h1>
    <div class="trainspotter-controls">
      <%= form_with url: requests_path, method: :get, data: { turbo_action: "replace" } do %>
        <% if @available_log_files.size > 1 %>
          <%= select_tag :log_file,
              options_for_select(@available_log_files, @current_log_file),
              class: "log-file-selector",
              onchange: "this.form.requestSubmit()" %>
        <% else %>
          <span class="current-log-file"><%= @current_log_file %></span>
        <% end %>
        <%= select_tag :ip,
            options_for_select([["All IPs", ""]] + @available_ips.map { |ip| [ip, ip] }, @current_ip),
            class: "ip-filter-selector",
            onchange: "this.form.requestSubmit()" %>
      <% end %>
      <label class="auto-scroll-toggle">
        <input type="checkbox" checked id="auto-scroll" onchange="window.trainspotterAutoScroll = this.checked">
        Auto-scroll
      </label>
      <span class="connection-status" id="connection-status">‚óè</span>
      <%= link_to "Sessions", sessions_path, class: "nav-link" %>
    </div>
  </header>

  <main class="trainspotter-main">
    <div class="request-list" id="request-list">
      <% @requests.each do |request| %>
        <%= render "trainspotter/requests/request", request: request %>
      <% end %>
    </div>

    <% if @requests.empty? %>
      <div class="empty-state" id="empty-state">
        <p>No requests found in the log file.</p>
        <p class="hint">Make some requests to your Rails app to see them here.</p>
      </div>
    <% end %>
  </main>
</div>

<turbo-stream-source src="<%= stream_requests_path(log_file: @current_log_file, ip: @current_ip, since_id: @last_id) %>"></turbo-stream-source>
